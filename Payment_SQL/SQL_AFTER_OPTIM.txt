WITH latest_case_tag AS ( SELECT t3.* FROM table1 t3 JOIN ( SELECT column1, MAX(column6) AS column6 FROM table1 WHERE column6 > 'value9' GROUP BY column1 ) t2 ON t3.column1 = t2.column1 AND t3.column6 = t2.column6 WHERE t3.column6 > 'value9' ) SELECT * FROM ( SELECT t1.column0, t1.column1 AS column1_1, t1.column2, t1.column3, MAX(t1.column4) AS column4 FROM table0 t1 WHERE t1.column5 IN ('value0') AND t1.column0 IN ('value1', 'value2') AND t1.column2 IN ('value3', 'value4', 'value5') AND t1.column3 BETWEEN 'value6' AND 'value7' AND t1.column6 = 'value8' AND t1.column4 = 0 GROUP BY t1.column0, t1.column1, t1.column2, t1.column3 ) a0 LEFT JOIN latest_case_tag a1 ON a0.column1_1 = a1.column1 WHERE ((a0.column2 = 'value3' AND a0.column0 = 'value1') AND ((a1.column7 = 'value10') OR (a1.column8 = 'value11' AND a1.column9 IN ('value12', 'value13', 'value14', 'value15')) OR (a1.column8 = 'value11' AND a1.column10 IN ('value16')) OR (a1.column8 = 'value11' AND a1.column11 LIKE '%value17%') OR (a1.column8 = 'value11' AND a1.column12 IN ('value18', 'value19')))) OR ((a0.column2 = 'value4' AND a0.column0 = 'value1') AND ((a1.column13 = 'value20') OR (a1.column8 = 'value11' AND a1.column14 IN ('value21', 'value22')) OR (a1.column8 = 'value11' AND a1.column9 IN ('value12')) OR (a1.column8 = 'value11' AND a1.column10 IN ('value23', 'value16')) OR (a1.column8 = 'value11' AND a1.column11 LIKE '%value24%') OR (a1.column8 = 'value11' AND a1.column15 IN ('value25', 'value26')) OR (a1.column8 = 'value11' AND a1.column12 IN ('value18', 'value19')))) OR (a0.column2 = 'value5') OR (a0.column2 = 'value3' AND a0.column0 = 'value2') OR (a0.column2 = 'value4' AND a0.column0 = 'value2')
WITH base_data AS ( SELECT CASE WHEN IFNULL(column0, 'UNKNOWN') = 'string0' THEN 'string0' ELSE 'string1' END AS column0, CASE WHEN ( (CONCAT(NVL(column2, ''), NVL(column3, '')) RLIKE '.*string2.*' AND CONCAT(NVL(column2, ''), NVL(column3, '')) NOT RLIKE '.*string3.*') OR (NVL(column4, '') RLIKE '.*string4.*' AND NVL(column4, '') NOT RLIKE '.*string5.*') OR (CONCAT(NVL(column5, ''), NVL(column6, ''), NVL(column7, '')) RLIKE '.*string2.*') OR (CONCAT(NVL(column8, ''), NVL(column9, ''), NVL(column10, ''), NVL(column11, '')) RLIKE '.*string6.*' AND CONCAT(NVL(column8, ''), NVL(column9, ''), NVL(column10, ''), NVL(column11, '')) NOT RLIKE '.*string7.*') ) AND NVL(column12, '') NOT RLIKE '.*string8.*' THEN 'string0' ELSE 'string1' END AS column1 FROM table0 whole_tb WHERE whole_tb.column13 = '20241030' AND column14 IS NOT NULL ) SELECT COUNT(*) AS SUM, column0, column1 FROM base_data GROUP BY column0, column1;
WITH table1 AS ( SELECT column11, column10, column9, column8, column4, column5, column12, column13 FROM table2 WHERE column14 >= string1 AND column9 = string3 AND column15 IN (string4, string5) AND column4 = 1 AND column12 > 0 UNION ALL SELECT column11, column10, column9, column8, column4, column5, column12, column13 FROM table3 WHERE column9 = string3 AND column14 = string0 AND column15 IN (string4, string5) AND column4 = 1 AND column12 > 0 ), table6 AS ( SELECT * FROM table4 WHERE column16 = string1 AND column1 = string3 AND column17 <= string2 ), table0 AS ( SELECT table1.column8 AS column0, table1.column9 AS column1, table1.column10 AS column2, table1.column11 AS column3, table1.column4 AS column4, table1.column5 AS column5, table1.column12 AS column6, table1.column13 AS column7 FROM table1 INNER JOIN table6 ON table1.column9 = table6.column1 ), table5 AS ( SELECT column11, column10, column9, column12, column18 FROM table2 WHERE column14 >= string1 AND column15 IN (string6, string7) AND column4 = 1 ), table7 AS ( SELECT table5.column10 AS column2, table5.column11 AS column3, column18 FROM table5 INNER JOIN table6 ON table5.column9 = table6.column1 ) SELECT table0.column0, table0.column1, table0.column2, table0.column3, table0.column4, table0.column5, table0.column6, table0.column7 FROM table0 LEFT JOIN table7 ON table0.column3 = table7.column3 WHERE table7.column3 IS NULL OR (table0.column6 != table7.column18)
WITH subquery0 AS ( SELECT column0 FROM table0 LIMIT 1 ) SELECT column1, column2, column3, column4, column5, column6, column7, column8, column9, column10, CASE WHEN column11 IS NULL THEN NULL WHEN column11 = '' THEN '' ELSE cast(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column11, 68)), `binary`(k.column0), hive_unbase64(substr(column11, 26, 16)), 12, hive_unbase64(substr(column11, 1, 24)), hive_unbase64(substr(column11, 43, 24))) AS STRING) END AS column11, CASE WHEN column12 IS NULL THEN NULL WHEN column12 = '' THEN '' ELSE cast(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column12, 68)), `binary`(k.column0), hive_unbase64(substr(column12, 26, 16)), 12, hive_unbase64(substr(column12, 1, 24)), hive_unbase64(substr(column12, 43, 24))) AS STRING) END AS column12, CASE WHEN column13 IS NULL THEN NULL WHEN column13 = '' THEN '' ELSE cast(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column13, 68)), `binary`(k.column0), hive_unbase64(substr(column13, 26, 16)), 12, hive_unbase64(substr(column13, 1, 24)), hive_unbase64(substr(column13, 43, 24))) AS STRING) END AS column13, CASE WHEN column14 IS NULL THEN NULL WHEN column14 = '' THEN '' ELSE cast(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column14, 68)), `binary`(k.column0), hive_unbase64(substr(column14, 26, 16)), 12, hive_unbase64(substr(column14, 1, 24)), hive_unbase64(substr(column14, 43, 24))) AS STRING) END AS column14, column15, column16, column17, column18, CASE WHEN column19 IS NULL THEN NULL WHEN column19 = '' THEN '' ELSE cast(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column19, 68)), `binary`(k.column0), hive_unbase64(substr(column19, 26, 16)), 12, hive_unbase64(substr(column19, 1, 24)), hive_unbase64(substr(column19, 43, 24))) AS STRING) END AS column19, column20, column21, column22, column23, column24, column25, unix_timestamp(column26, 'yyyy-MM-dd HH:mm:ss') AS column26, unix_timestamp(column27, 'yyyy-MM-dd HH:mm:ss') AS column27, column28, column29, column30, column31, column32, column33, column34, unix_timestamp(column35, 'yyyy-MM-dd HH:mm:ss') AS column35 FROM table1 PARTITION (p_20250101) p JOIN subquery0 k ON (1 = 1) WHERE column1 = 100010000
WITH donation_record AS ( SELECT column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28 FROM ( SELECT column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28, ROW_NUMBER() OVER (PARTITION BY column16, column23 ORDER BY column11 DESC, column25 DESC) AS rn FROM ( SELECT column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28 FROM database0::table1 WHERE column8 = '20241219' UNION ALL SELECT CAST(column11 AS BIGINT) AS column11, column12, column13, column14, CAST(column15 AS BIGINT) AS column15, CAST(column16 AS BIGINT) AS column16, CAST(column17 AS BIGINT) AS column17, CAST(column18 AS BIGINT) AS column18, CAST(column19 AS BIGINT) AS column19, CASE WHEN array_contains(split(column29, ';'), "13-B64") THEN unbase64(column21) ELSE column21 END AS column21, CAST(column22 AS BIGINT) AS column22, column23, CAST(column24 AS BIGINT) AS column24, CAST(column25 AS BIGINT) AS column25, CASE WHEN array_contains(split(column29, ';'), "16-B64") THEN unbase64(column26) ELSE column26 END AS column26, CASE WHEN array_contains(split(column29, ';'), "17-B64") THEN unbase64(column27) ELSE column27 END AS column27, CASE WHEN array_contains(split(column29, ';'), "18-B64") THEN unbase64(column28) ELSE column28 END AS column28 FROM database1::table2 WHERE column30 >= '2024122000' AND column30 <= '2024122023' AND column14 NOT LIKE "TestProject%" ) ) WHERE rn = 1 ) SELECT COUNT(*) FROM ( SELECT column0, column1, column2, column3, column4, column5, column6, column7 FROM database0::table0 WHERE column8 = '20241219' AND column9 = 7 AND column10 = 2 ) order_table LEFT OUTER JOIN donation_record ON ( order_table.column1 = donation_record.column16 AND order_table.column5 = donation_record.column23 AND order_table.column0 = donation_record.column14 AND order_table.column6 = donation_record.column26 AND order_table.column7 = donation_record.column27 ) WHERE donation_record.column16 IS NULL;
WITH index_data AS ( SELECT 'action0' AS action_, COUNT(*) AS pv, COUNT(DISTINCT column1) AS uv FROM table0 WHERE column0 >= 'date0' AND column0 <= 'date1' AND column2 = 'value0' AND column3 = 'value1' ), key_point_data AS ( SELECT column4 AS action_, COUNT(*) AS pv, COUNT(DISTINCT column1) AS uv FROM table1 WHERE ds >= 'date0' AND ds <= 'date1' AND column4 IN ('action9', 'action8', 'action6', 'action7', 'action1', 'action2', 'action3', 'action4', 'action5') AND get_json_object(column5, '$.source') = 'value0' GROUP BY column4 ), combined_data AS ( SELECT action_, pv, uv FROM index_data UNION ALL SELECT action_, pv, uv FROM key_point_data ) SELECT CASE WHEN action_ = 'action0' THEN 'string0' WHEN action_ = 'action1' THEN 'string1' WHEN action_ = 'action2' THEN 'string2' WHEN action_ = 'action3' THEN 'string3' WHEN action_ = 'action4' THEN 'string4' WHEN action_ = 'action5' THEN 'string5' WHEN action_ = 'action6' THEN 'string6' WHEN action_ = 'action7' THEN 'string7' WHEN action_ = 'action8' THEN 'string8' WHEN action_ = 'action9' THEN 'string9' END AS action_name_, pv, uv FROM combined_data;
WITH base_data AS ( SELECT column0_ column0, column1_ column1, MAX(IF(column2_ = '', NULL, column2_)) column2, REGEXP_EXTRACT(column1_, '(^[a-z_]+_|^wx)([a-z0-9]+)', 2) column3, MAX(IF(column4_ = '', NULL, column4_)) column4, MAX(IF(column5_ = '', NULL, column5_)) column5, MAX(IF(column6_ = '', NULL, column6_)) column6, MAX(IF(column7_ = '', NULL, column7_)) column7, MAX(IF(column8_ = '' OR column8_ = '0', NULL, column8_)) column8, MAX(IF(column9_ = '' OR column9_ = '0', NULL, column9_)) column9, MAX(IF(column6_ IS NOT NULL OR column6_ != '', column6_, column7_)) column12, column10_ column10 FROM table0::table1 PARTITION (p_20241222) p WHERE column1_ IS NOT NULL AND column1_ != '' AND column1_ != '0' AND column0_ > 0 AND column10_ IS NOT NULL AND column10_ != '' AND column10_ != '0' GROUP BY column1_, column0_, column10_ ), aggregated_data AS ( SELECT column0, MAX(column1) column1, MAX(column2) column2, column3, MAX(column4) column4, MAX(column5) column5, MAX(column6) column6, MAX(column7) column7, MAX(column8) column8, MAX(column9) column9, MAX(column12) column12, column10 FROM base_data GROUP BY column3, column0, column10 ) SELECT column0, column1, column2, IF(column3 IS NULL OR column3 = '', column1, column3) column3, column4, column5, column6, column7, NVL(column8, column2) column8, NVL(column9, column10) column9, column10, IF(column9 IS NULL OR column9 = column10, 0, 1) column11 FROM aggregated_data WHERE column3 = '2123591547938925dfc7aac86d19600001';
WITH t1 AS ( SELECT ds, mchid FROM table0 WHERE remark IN ("str1", "str2") AND ds >= 20241201 AND ds <= 20241231 ), t2 AS ( SELECT ds, fmerchantid, ftenpaymchid, cnt, amount, fee FROM ( SELECT fmerchantid, ftenpaymchid FROM table1 ) a1 JOIN ( SELECT ds, frecipient_tenpay_merchant_no, pay_cnt - refund_cnt AS cnt, pay_amount - refund_amount AS amount, pay_fee - refund_fee AS fee FROM table2 WHERE ds >= 20241201 AND ds <= 20241231 ) a2 ON a1.ftenpaymchid = a2.frecipient_tenpay_merchant_no ), t4 AS ( SELECT mchid, city FROM table3 ), t5 AS ( SELECT a1.fmerchantid, a1.fsubjectid, a2.FSubjectType, CASE WHEN FSubjectType = 2 THEN "str3" WHEN FSubjectType = 4 THEN "str4" WHEN FSubjectType = 2401 THEN "str5" WHEN FSubjectType IS NULL THEN "str6" WHEN FSubjectType = "\N" THEN "str6" ELSE "str6" END AS mch_type FROM table4 a1 LEFT JOIN table5 a2 ON a1.fsubjectid = a2.fsubjectid ) SELECT t1.ds, t4.city, t5.mch_type, count(DISTINCT t1.mchid) AS mch_activity, sum(t2.cnt) AS cnt, sum(t2.amount) / 100 AS amt_yuan, sum(t2.fee) / 100 AS fee_yuan, sum(t2.fee) / 900 AS fee_rl_yuan FROM t1 INNER JOIN t2 ON t1.mchid = t2.fmerchantid AND t1.ds = t2.ds LEFT JOIN t4 ON t1.mchid = t4.mchid LEFT JOIN t5 ON t1.mchid = t5.fmerchantid WHERE t4.city IN ("str7", "str8", "str9", "str10", "str11") GROUP BY t1.ds, t4.city, t5.mch_type;
WITH filtered_data AS ( SELECT column4 AS column0, from_unixtime(column5, 'yyyyMMddHHmmss') AS column1, substr(column6, 0, 8) AS column2, column7, column3 FROM database0::table0 WHERE column6 >= 20241129 AND column6 <= 20241212 AND column8 = 'string0' AND column9 = 'string1' AND column10 = 0 AND column7 != '' AND column3 != '' ) SELECT column0, column1, column2, column3 FROM filtered_data WHERE column3 IN ( 'string2', 'string3', 'string4', 'string5', 'string6', 'string7', 'string8', 'string9', 'string10', 'string11', 'string12', 'string13', 'string14', 'string15', 'string16', 'string17', 'string18', 'string19' ) GROUP BY column0, column1, column2, column3
WITH table4 AS ( SELECT column0, column1, column2 FROM table0 WHERE column2 IN (value0, value1) AND column3 IN (value2, value3, value4, value5) AND column4 = value6 ), table5 AS ( SELECT column0, column1, column2 FROM table1 WHERE column2 IN (value0, value1) AND column4 = value6 ) SELECT value0 AS column5, table6.column0 AS column0, (NVL(table6.column1, 0) - NVL(table7.column1, 0)) AS column6, (NVL(table8.column1, 0) - NVL(table9.column1, 0)) AS column7 FROM ( SELECT column0, column1 FROM table4 WHERE column2 = value0 ) table6 LEFT JOIN ( SELECT column0, column1 FROM table4 WHERE column2 = value1 ) table7 ON table6.column0 = table7.column0 LEFT JOIN ( SELECT column0, column1 FROM table5 WHERE column2 = value0 ) table8 ON table6.column0 = table8.column0 LEFT JOIN ( SELECT column0, column1 FROM table5 WHERE column2 = value1 ) table9 ON table6.column0 = table9.column0 WHERE (NVL(table6.column1, 0) - NVL(table7.column1, 0)) > 0 OR (NVL(table8.column1, 0) - NVL(table9.column1, 0)) > 0;
WITH base_data AS ( SELECT SUBSTR(column0, 1, 8) AS column0, column1 AS column1, column2 AS column2, column3 AS column3, column4 AS column4, column5 AS column5 FROM table0 WHERE CAST(column0 AS INT) BETWEEN 2024111300 AND 2024113023 AND column1 IN ('0.45.1', '0.47.1') AND column6 = '1' ) SELECT bd.column0, bd.column1, COUNT(DISTINCT CASE WHEN bd.column3 = 'string0' AND bd.column4 = 'string1' THEN bd.column2 END) AS column7, COUNT(DISTINCT CASE WHEN bd.column3 = 'string2' AND bd.column4 = 'string1' AND bd.column5 = 'string3' THEN bd.column2 END) AS column8, COUNT(DISTINCT CASE WHEN bd.column3 = 'string2' AND bd.column4 = 'string1' AND bd.column5 = 'string4' THEN bd.column2 END) AS column9 FROM base_data bd GROUP BY bd.column0, bd.column1;
WITH base_data AS ( SELECT cast(ds / 100 AS int) AS ds, count(*) AS time_cnt, count(DISTINCT column1) AS trade_cnt, count(DISTINCT column2) AS user_cnt FROM table0::table1 WHERE ds >= 2024100800 AND ds <= 2024121823 AND column0 = 268547318 GROUP BY cast(ds / 100 AS int) ), click_help_data AS ( SELECT ds, count(*) AS click_help_time_cnt, count(DISTINCT column3) AS click_help_trade_cnt, count(DISTINCT column4) AS click_help_user_cnt FROM table3::table4 WHERE ds >= 20241008 AND ds <= 20241218 GROUP BY ds ) SELECT a.ds, a.time_cnt, a.trade_cnt, a.user_cnt, d.click_help_time_cnt, d.click_help_trade_cnt, d.click_help_user_cnt FROM base_data a JOIN click_help_data d ON d.ds = a.ds;
WITH order_table AS ( SELECT column0, column1, column2, column3, column4, column5, column6, column7 FROM table0 WHERE column8 = 'string0' AND column9 = 7 AND column10 = 2 ), donation_record AS ( SELECT column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28 FROM ( SELECT column11, column12, column13, column14, column15, column16, column17, column18, column19, column20, column21, column22, column23, column24, column25, column26, column27, column28, ROW_NUMBER() OVER (PARTITION BY column16, column23 ORDER BY column11 DESC, column25 DESC) AS column29 FROM table0 WHERE column8 = 'string0' ) subquery WHERE column29 = 1 ) SELECT count(*) FROM order_table LEFT OUTER JOIN donation_record ON ( order_table.column1 = donation_record.column16 AND order_table.column5 = donation_record.column23 AND order_table.column0 = donation_record.column14 AND order_table.column6 = donation_record.column26 AND order_table.column7 = donation_record.column27 ) WHERE donation_record.column16 IS NULL;
WITH combined_data AS ( SELECT column2 AS column2, column3 FROM table0 WHERE ds BETWEEN date0 AND date1 AND column4 = value0 UNION ALL SELECT column5 AS column2, column6 AS column3 FROM table1 WHERE ds BETWEEN date0 AND date1 AND column7 IN ('value1') ) SELECT column0, COUNT(*) AS column1 FROM ( SELECT CASE WHEN COUNT(DISTINCT column2) BETWEEN 1 AND 5 THEN 'range0' WHEN COUNT(DISTINCT column2) BETWEEN 6 AND 9 THEN 'range1' WHEN COUNT(DISTINCT column2) BETWEEN 10 AND 19 THEN 'range2' WHEN COUNT(DISTINCT column2) BETWEEN 20 AND 29 THEN 'range3' WHEN COUNT(DISTINCT column2) BETWEEN 30 AND 39 THEN 'range4' WHEN COUNT(DISTINCT column2) BETWEEN 40 AND 49 THEN 'range5' WHEN COUNT(DISTINCT column2) BETWEEN 50 AND 59 THEN 'range6' WHEN COUNT(DISTINCT column2) BETWEEN 60 AND 69 THEN 'range7' WHEN COUNT(DISTINCT column2) BETWEEN 70 AND 79 THEN 'range8' WHEN COUNT(DISTINCT column2) BETWEEN 80 AND 89 THEN 'range9' WHEN COUNT(DISTINCT column2) BETWEEN 90 AND 99 THEN 'range10' ELSE 'range11' END AS column0, column3 FROM combined_data GROUP BY column3 ) AS user_data GROUP BY column0
WITH table4 AS ( SELECT column12 FROM table5 UNION SELECT column12 FROM table6 UNION SELECT column12 FROM table7 ) SELECT COUNT(DISTINCT table0.column0) AS uuid_cnt FROM ( SELECT DISTINCT column0, column1, column2, IF (unix_timestamp(column3) >= unix_timestamp('date0') AND unix_timestamp(column3) < unix_timestamp('date1'), 1, 0) AS column4, column5, (column6 + column7) AS column8 FROM table1 WHERE column9 = 'value0' ORDER BY rand(1) DESC ) table0 LEFT JOIN ( SELECT DISTINCT column0 FROM table2 WHERE column9 = 'value0' AND column10 = 'value1' AND column11 = 'value2' ) table3 ON table0.column0 = table3.column0 LEFT JOIN table4 ON table0.column0 = table4.column12 WHERE table0.column8 > 'value3' AND table0.column4 = 'value3' AND table0.column1 = 'value2' AND table0.column2 = 'value3' AND table3.column0 IS NULL AND table4.column12 IS NULL
WITH decrypted_data AS ( SELECT ds, column0, column8, column9, column10, column3, column5, column2, CASE WHEN column1 IS NULL OR column1 = '' THEN '' ELSE CAST(sm4_GCMDecryptNoPadding(hive_unbase64(substr(column1, 68)), `BINARY`(k1.column11), hive_unbase64(substr(column1, 26, 16)), 12, hive_unbase64(substr(column1, 1, 24)), hive_unbase64(substr(column1, 43, 24))) AS STRING) END AS column1, column4 FROM table0 PARTITION (p_20241222) t0 CROSS JOIN ( SELECT column11 FROM table1 LIMIT 1 ) k1 ) SELECT t1.column0, t1.column1, t1.column2, t1.column3, t1.column4, t1.column5, t1.column2, t2.column6, t2.column7 FROM decrypted_data t1 LEFT JOIN table2 PARTITION (p_20241222) t2 ON t1.column0 = t2.column0 WHERE t1.column8 IN (666538550, 670278753) AND t1.column1 = '445281200106222122' AND t1.column10 = 504
SELECT column0, column1, column2, column3, column4, column5, column6, column7, column8, CASE WHEN instr(NVL(column9, ''), '|a|') = 0 THEN column9 ELSE '|b|' END AS column9, 20230101 FROM table0 WHERE statis_day = 20230101 AND column1 = 1234567890 AND ( (column8 = 2 AND ((column10 < 2 AND from_unixtime(unix_timestamp(substr(column7, 0, 10), 'yyyy-MM-dd'), 'yyyyMMdd') < '20230101') OR column10 = 1) AND instr(NVL(column9, ''), '|a|') = 0) OR (from_unixtime(unix_timestamp(substr(column7, 0, 10), 'yyyy-MM-dd'), 'yyyyMMdd') <= '20230101' AND (column11 != 0 OR column12 != 0) AND instr(NVL(column9, ''), '|a|') != 0) )
WITH combined_data AS ( SELECT column0 AS column0, from_unixtime(column1, 'yyyyMMddHHmmss') AS real_time, substr(column2, 0, 8) AS statis_day, column3, column7 FROM table0 WHERE column2 >= 20241231 AND column2 <= 20250113 AND column4 = 'string0' AND column5 = 'string1' AND column6 = 0 AND column3 != '' AND column7 != '' ) SELECT column0, real_time, statis_day, column7 FROM combined_data WHERE column7 IN ( 'device0', 'device1', 'device2', 'device3', 'device4', 'device5', 'device6', 'device7', 'device8', 'device9' ) GROUP BY column0, real_time, statis_day, column7
WITH base_data AS ( SELECT CAST(column1 AS BIGINT) AS column1, CAST(column2 AS BIGINT) AS column2, CAST(column3 AS BIGINT) AS column3, column4, column5, CAST(column6 AS BIGINT) AS column6, CAST(column7 AS BIGINT) AS column7, column8, column9, column10, CAST(column11 AS BIGINT) AS column11, CAST(column12 AS BIGINT) AS column12, column13, CASE WHEN array_contains(split(column17, ';'), 'string0') THEN unbase64(column14) ELSE column14 END AS column14, CAST(column15 AS BIGINT) AS column15, CAST(column0 AS BIGINT) AS column0 FROM database0::table0 WHERE column18 = '2024121019' ), ranked_data AS ( SELECT column1, column2, column3, column4, column5, column6, column7, column8, column9, column10, column11, column12, column13, column14, column15, column0, ROW_NUMBER() OVER (PARTITION BY column7, column8, column13 ORDER BY column3 DESC, column2 DESC) AS rn FROM base_data ) SELECT SUM(column0) AS total_column0 FROM ranked_data WHERE rn = 1 AND column12 = 2 AND column9 = 'string1' AND column10 = 'string2';
WITH d1 AS ( SELECT column9, column10 FROM ( SELECT column9, column10, row_number() OVER (PARTITION BY column9 ORDER BY column11 DESC, column12 DESC) AS column13 FROM table2::table3 WHERE column4 <= 2024110123 AND column4 >= 2024102600 AND from_unixtime(CAST(column14 AS BIGINT), 'yyyyMMdd') <= 20241101 AND from_unixtime(CAST(column14 AS BIGINT), 'yyyyMMdd') >= 20241026 ) WHERE column13 = 1 ), d2 AS ( SELECT column2, column15 FROM table4::table5 WHERE column4 = 20241101 ) SELECT count(DISTINCT column0) AS column1 FROM ( SELECT A.column0 AS column0, B.column2 AS column3 FROM ( SELECT column0 FROM table0::table1 WHERE column4 <= 2024110123 AND column4 >= 2024102600 AND column5 = 'string0' AND column6 = 'string1' AND column7 = 'string2' AND column8 = 'string3' ) A INNER JOIN ( SELECT DISTINCT d2.column2 FROM d1 INNER JOIN d2 ON d1.column10 = d2.column15 WHERE d2.column2 IS NOT NULL ) B ON A.column0 = B.column2 ) S
WITH reddot_subquery AS ( SELECT regexp_extract(column4, '/nearbyminishopfeedreddot_(usershop)_(\\d*)_(\\w*)/count', 2) AS column0, regexp_extract(column4, '/nearbyminishopfeedreddot_(usershop)_(\\d*)_(\\w*)/count', 3) AS column3 FROM database0::table0 WHERE 2024121900 <= column5 AND column5 <= 2024121923 GROUP BY regexp_extract(column4, '/nearbyminishopfeedreddot_(usershop)_(\\d*)_(\\w*)/count', 2), regexp_extract(column4, '/nearbyminishopfeedreddot_(usershop)_(\\d*)_(\\w*)/count', 3) ), cardpv_subquery AS ( SELECT NVL(get_json_object(column7, '$.shopId'), '') AS column3, NVL(column8, 0) AS column0, COUNT(1) AS column6 FROM database1::table1 WHERE 2024121900 <= column9 AND column9 <= 2024121923 AND column10 = 'string0' AND column11 = 'string1' AND column12 = 'string2' AND column13 = 'string3' GROUP BY NVL(get_json_object(column7, '$.shopId'), ''), NVL(column8, 0) ) SELECT COUNT(t_reddot.column0) AS column1, COUNT(t_cardpv.column0) AS column2 FROM reddot_subquery t_reddot LEFT JOIN cardpv_subquery t_cardpv ON t_reddot.column0 = t_cardpv.column0 AND t_reddot.column3 = t_cardpv.column3;
WITH filtered_settle AS ( SELECT column0, column1 FROM table0 WHERE column4 IN ("string0", "string1") AND column0 = "string2" ), mch_info AS ( SELECT column1, column2 FROM table1 WHERE column2 IN ("string3", "string3", "string3", "string3", "string3") ), mch_type AS ( SELECT a1.column6, CASE WHEN a2.column5 = 2 THEN "string4" WHEN a2.column5 = 4 THEN "string5" WHEN a2.column5 = 2401 THEN "string6" WHEN a2.column5 IS NULL THEN "string7" WHEN a2.column5 = "\N" THEN "string7" ELSE "string7" END AS column3 FROM table2 PARTITION (string8) a1 LEFT JOIN table3 PARTITION (string8) a2 ON a1.column7 = a2.column7 ) SELECT t1.column0, t2.column2, t3.column3, COUNT(DISTINCT t1.column1) AS mch_num FROM filtered_settle t1 LEFT JOIN mch_info t2 ON t1.column1 = t2.column1 LEFT JOIN mch_type t3 ON t1.column1 = t3.column6 GROUP BY t1.column0, t2.column2, t3.column3;
WITH base_data AS ( SELECT nvl(column0, 'str0') AS column0, nvl(column1, 'str0') AS column1, NVL(column2, 'str0') AS column2, column5, column4 FROM table0 WHERE column6 = 20241111 AND column2 IN ('str1', 'str2', 'str3', 'str4') ) SELECT a.column0, a.column1, a.column2, a.column3, b.column4 FROM (SELECT column0, column1, column2, count(DISTINCT column5) AS column3 FROM base_data GROUP BY column0, column1, column2 WITH CUBE) a LEFT JOIN (SELECT column2, column4 FROM base_data GROUP BY column2, column4) b ON a.column2 = b.column2;
WITH base_query AS ( SELECT a.column0, a.column1, a.column2, a.column3, a.column4, a.column5 FROM table0 a WHERE a.column6 != 5 AND a.column7 = 'string0' AND a.column8 = 'string1' ), distinct_counts AS ( SELECT column0, COUNT(DISTINCT column1) AS column9, SUM(column2) AS column10, COUNT(DISTINCT column3, column4) AS column11, COUNT(DISTINCT column5) AS column12 FROM base_query GROUP BY column0 ), total_counts AS ( SELECT 0 AS column0, COUNT(DISTINCT column1) AS column9, SUM(column2) AS column10, COUNT(DISTINCT column3, column4) AS column11, COUNT(DISTINCT column5) AS column12 FROM base_query ) SELECT * FROM distinct_counts UNION ALL SELECT * FROM total_counts;
WITH table5 AS ( SELECT column7, COUNT(1) AS column5 FROM ( SELECT NVL(get_json_object(action_value_, '$.column7'), '') AS column7 FROM table4 WHERE ds BETWEEN 2023010100 AND 2023010123 AND sys_id_ = '1234567890123456' AND mode_ = 'release_mode' AND page_ = 'page_path' AND action_ = 'action_type' ) GROUP BY column7 HAVING column7 <> '' ) SELECT column2, column4, SUM(column5) AS column5 FROM ( SELECT table1.column1, table1.column0, table1.column7, table1.column2, IF(table3.column3 IS NULL, 0, 1) AS column4, table5.column5 FROM ( SELECT column0, column1 AS column3, column7, column2 FROM table0 WHERE column6 = 20230101 ) table1 LEFT JOIN table2 table3 ON table1.column3 = table3.column3 LEFT JOIN table5 ON table1.column0 = table5.column7 ) GROUP BY column2, column4
WITH pre_aggregated AS ( SELECT t_join.column0, t_join.column1, t_join.column2, CASE WHEN t_join.column3 = 'value0' THEN 1 ELSE 0 END AS column12, CASE WHEN t_join.column5 = 'value1' THEN 1 ELSE 0 END AS column13, CASE WHEN t_join.column5 = 'value2' THEN 1 ELSE 0 END AS column14, CASE WHEN t_join.column3 = 'value0' THEN t_join.column8 ELSE NULL END AS column15, CASE WHEN t_join.column5 = 'value1' THEN t_join.column8 ELSE NULL END AS column16, CASE WHEN t_join.column5 = 'value2' THEN t_join.column8 ELSE NULL END AS column17 FROM database0::table0 t_join ) SELECT column0, column1, column2, nvl(SUM(column12), 0) AS column4, nvl(SUM(column13), 0) AS column6, nvl(SUM(column14), 0) AS column7, nvl(COUNT(DISTINCT column15), 0) AS column9, nvl(COUNT(DISTINCT column16), 0) AS column10, nvl(COUNT(DISTINCT column17), 0) AS column11 FROM pre_aggregated GROUP BY column0, column1, column2;
WITH combined_data AS ( SELECT column0, column3 AS cover_session_id, column1, column2, column8 FROM table0 WHERE column0 >= 2024111300 AND column0 <= 2024112224 AND column4 LIKE 'X8AZ%' AND column5 != 2 AND column6 = '0.45.1' AND column7 = 'value1' ) SELECT SUBSTR(t1.column0, 1, 8) AS dataDate, t1.column1, COUNT(*) AS pvNumber FROM (SELECT column0, cover_session_id, column1 FROM combined_data WHERE column2 = 'value0') t1 JOIN (SELECT cover_session_id FROM combined_data WHERE column2 = 'value2' AND column8 = 'value3') t2 ON t1.cover_session_id = t2.cover_session_id GROUP BY SUBSTR(t1.column0, 1, 8), t1.column1
WITH table1 AS ( SELECT column4 AS column1, column3, column7, column10, ROW_NUMBER() OVER (PARTITION BY column1, column7 ORDER BY column3) AS column5 FROM table0 WHERE column6 = string0 AND (column7 = string1 OR (column7 = string2 AND column10 = string3)) ) SELECT AVG(column0) FROM ( SELECT t1.column1, (t2.column3 - t1.column3) AS column0 FROM (SELECT column1, column3 FROM table1 WHERE column7 = string1 AND column5 = 1) t1 JOIN (SELECT column1, column3 FROM table1 WHERE column7 = string2 AND column10 = string3 AND column5 = 1) t2 ON t1.column1 = t2.column1 AND t2.column3 > t1.column3 ) subquery WHERE column0 > 2999 AND column0 < 6000;
WITH base_data AS ( SELECT nvl(column0, 'string0') AS column0, nvl(column1, 'string0') AS column1, NVL(column2, 'string0') AS column2, column5, column4 FROM database0::table0 WHERE column6 = 20241111 AND column2 IN ('string1', 'string2') ) SELECT a.column0, a.column1, a.column2, a.column3, b.column4 FROM (SELECT column0, column1, column2, count(DISTINCT column5) AS column3 FROM base_data GROUP BY column0, column1, column2 WITH CUBE) a LEFT JOIN (SELECT column2, column4 FROM base_data GROUP BY column2, column4) b ON a.column2 = b.column2;
WITH monthly_aggregates AS ( SELECT SUBSTR(a0.column0, 1, 6) AS d, COUNT(DISTINCT a0.column1) AS count_uin, COUNT(DISTINCT a0.column2) AS count_num, SUM(a0.column3) / 100 AS sum_money_yuan FROM table0 a0 WHERE a0.column0 >= '20240901' AND a0.column0 <= '20241228' GROUP BY SUBSTR(a0.column0, 1, 6) ), first_loan_counts AS ( SELECT SUBSTR(a0.column0, 1, 6) AS d, COUNT(DISTINCT IF(a1.column4 = SUBSTR(a0.column0, 1, 6), a0.column1, NULL)) AS first_count_uin FROM table0 a0 LEFT JOIN ( SELECT column0, column1, SUBSTR(column5, 1, 6) AS column4, SUBSTR(column6, 1, 6) AS column7 FROM table1 WHERE column0 = '20241228' ) a1 ON a0.column1 = a1.column1 WHERE a0.column0 >= '20240901' AND a0.column0 <= '20241228' GROUP BY SUBSTR(a0.column0, 1, 6) ) SELECT ma.d, ma.count_uin, ma.count_num, ma.sum_money_yuan, flc.first_count_uin FROM monthly_aggregates ma JOIN first_loan_counts flc ON ma.d = flc.d ORDER BY ma.d;
WITH restrict_prob_cte AS ( SELECT column0_, CAST(get_json_object(unbase64(column7), '$.column1') AS DOUBLE) AS column1 FROM table2 WHERE column2 >= 2024120100 AND column2 <= 2024120123 AND column3 = 'string0' AND column4 = 'string1' ), user_account_cte AS ( SELECT t21.column0, t22.column1 FROM table1 AS t21 JOIN restrict_prob_cte AS t22 ON t21.column0 = t22.column0_ WHERE column2 = 20241201 AND column5 = 'string2' AND t22.column1 < 35 ) SELECT count(DISTINCT t2.column0) FROM table0 t1 RIGHT JOIN user_account_cte t2 ON t1.column0 = t2.column0 WHERE t1.column6 = 20241201 AND t1.column1 >= 35;
WITH merchant_docs AS ( SELECT column0, column1, column2, column3, column4, column5, column6, column7, column8, column9 FROM table0 WHERE ds = 'string0' ), rules AS ( SELECT DISTINCT column12 AS column0 FROM table1 WHERE ds = 'string1' AND column10 = 'string2' AND column11 = 'string3' ), fund AS ( SELECT column13 FROM table2 WHERE ds = 'string1' ) SELECT count(1) FROM merchant_docs LEFT JOIN rules ON merchant_docs.column0 = rules.column0 LEFT JOIN fund ON merchant_docs.column0 = fund.column13 WHERE rules.column0 IS NULL;
SELECT column0, column1, column2, COUNT(*) AS column11 FROM ( SELECT column5 AS column0, column1, column2, COUNT(*) OVER (PARTITION BY column5) AS column10 FROM table0 WHERE column3 = 'string0' AND column4 BETWEEN 'string1' AND 'string2' AND column5 LIKE 'string3' AND column6 != 'string4' AND column7 = 'string5' AND column8 = 'string6' AND column9 = 'string7' AND column1 = 'string8' ) subquery WHERE column10 > 3 GROUP BY column0, column1, column2 ORDER BY column0;
SELECT table0.column0, table0.column1, table0.column2, table0.column3, table1.column4, table1.column5 FROM database0::table0 table0 LEFT JOIN (SELECT column6, column7, COUNT(1) AS column4, SUM(column8) AS column5 FROM database1::table2 WHERE column9 BETWEEN '20241210' AND '20241219' GROUP BY column6, column7) table1 ON table0.column0 = table1.column6 AND table0.column2 = table1.column7 WHERE table0.column3 = 2
SELECT count(DISTINCT column0) AS uin_num FROM ( SELECT A.column2 AS column0, B.column3 AS column1 FROM ( SELECT column2 FROM table0 WHERE ds <= date0 AND ds >= date1 AND sys_id_ = 'string0' AND page_ = 'string1' AND action_ = 'string2' AND module_ = 'string3' ) A INNER JOIN ( SELECT DISTINCT column3 FROM table1 WHERE ds = date2 AND fchanneltype = number0 ) B ON A.column2 = B.column3 )
WITH table1 AS ( SELECT column1, NVL(column0, 0) AS column0, COUNT(column4) AS column6 FROM table0 WHERE column5 = value0 GROUP BY column1, column0 ) SELECT table2.column0, table2.column1, table2.column2, table3.column3 FROM (SELECT column0, column1, SUM(column6) AS column2 FROM table1 GROUP BY column1, column0 ) table2 JOIN (SELECT column0, SUM(column6) AS column3 FROM table1 GROUP BY column0 ) table3 ON table2.column0 = table3.column0;
WITH ranked_records AS ( SELECT column0, column5 AS column1, column6 AS column2, column7 AS column3, column8 AS column4, ROW_NUMBER() OVER (PARTITION BY column5 ORDER BY column9 DESC, column7 DESC) AS row_id FROM table0 WHERE column0 >= 202412301800 AND column5 IN ('string0', 'string1') ) SELECT column0, column1, column2, column3, column4 FROM ranked_records WHERE row_id = 1;
WITH table2 AS ( SELECT DISTINCT column0 FROM table0 WHERE column2 = 20230101 AND column3 > 0 ), table3 AS ( SELECT DISTINCT column0, column1 FROM table1 WHERE column1 IN (2, 3) AND column2 = 20230101 ) SELECT CASE WHEN column1 = 2 THEN 1 WHEN column1 = 3 THEN 2 ELSE 0 END AS column1, COUNT(table2.column0) AS column4 FROM table2 JOIN table3 ON table2.column0 = table3.column0 GROUP BY ROLLUP(column1)
WITH table2 AS ( SELECT target_data.column0, CASE WHEN target_data.column3 > string4 THEN 1 ELSE 0 END AS column7, CASE WHEN target_data.column3 < string4 THEN 1 ELSE 0 END AS column8 FROM ( SELECT column0, column1, column2, column3 FROM table0 WHERE column4 = string0 AND column6 IN (string1, string2) AND column1 > 0 ) target_data JOIN ( SELECT DISTINCT column0 FROM table1 WHERE column5 = string3 AND column4 = string0 ) fauthen_account ON target_data.column0 = fauthen_account.column0 ) SELECT SUM(column7) AS string5, SUM(column8) AS string6 FROM table2;
WITH combined_data AS ( SELECT * FROM database0::table0 WHERE column3 > '20220201' UNION ALL SELECT * FROM database0::table1 WHERE column3 > '20220201' ) SELECT AVG(column0) FROM ( SELECT *, ROW_NUMBER() OVER (PARTITION BY column1 ORDER BY column2 DESC) AS id FROM combined_data ) b WHERE id = 1 AND column4 IN (2128244, 2134572, 2220533) AND column5 = 486414;
WITH combined_data AS ( SELECT column0, column1, column2, column3, column4, column5, 'source0' AS source FROM table0 WHERE ds = 202301 AND mchid = 123456789 UNION ALL SELECT column0, column1, column2, column3, column4, column5, 'source1' AS source FROM table1 WHERE ds = 202301 AND mchid = 123456789 ) SELECT column0, column1, column2, column3, MAX(CASE WHEN source = 'source0' THEN column4 END) AS new_column4, MAX(CASE WHEN source = 'source1' THEN column4 END) AS old_column4, MAX(CASE WHEN source = 'source0' THEN column5 END) AS new_column5, MAX(CASE WHEN source = 'source1' THEN column5 END) AS old_column5 FROM combined_data GROUP BY column0, column1, column2, column3 HAVING MAX(CASE WHEN source = 'source0' THEN column5 END) IS NULL OR MAX(CASE WHEN source = 'source1' THEN column5 END) IS NULL OR MAX(CASE WHEN source = 'source0' THEN column5 END) <> MAX(CASE WHEN source = 'source1' THEN column5 END);
SELECT COUNT(*) FROM ( SELECT concat('prefix_', substr(column0, -4, 3), 'suffix_', substr(column0, -1, 1)) AS groupdb_id, column0 FROM table0 WHERE column1 = 2023010100 AND column2 IN (1, 2) ) pay INNER JOIN ( SELECT column0 FROM table1 WHERE column1 = 2023010100 AND column3 NOT IN (3, 4) ) bill ON pay.column0 = bill.column0
SELECT 0 AS column0, t1.column1, t2.column2, t3.column3, t4.column4, t1.column5 FROM (SELECT table0.column5, COUNT(DISTINCT table0.column6) AS column1 FROM database0::table0 WHERE table0.column11 = 20231125 AND table0.column12 = 3 GROUP BY table0.column5) t1 JOIN (SELECT table0.column5, SUM(table0.column7) AS column2 FROM database0::table0 WHERE table0.column11 = 20231125 AND table0.column12 = 3 GROUP BY table0.column5) t2 ON t1.column5 = t2.column5 JOIN (SELECT table0.column5, COUNT(DISTINCT table0.column8, table0.column9) AS column3 FROM database0::table0 WHERE table0.column11 = 20231125 AND table0.column12 = 3 GROUP BY table0.column5) t3 ON t1.column5 = t3.column5 JOIN (SELECT table0.column5, COUNT(DISTINCT table0.column10) AS column4 FROM database0::table0 WHERE table0.column11 = 20231125 AND table0.column12 = 3 GROUP BY table0.column5) t4 ON t1.column5 = t4.column5;
WITH combined_data AS ( SELECT *, row_number() over(PARTITION BY column1 ORDER BY column2 DESC) AS id FROM ( SELECT * FROM database0::table0 WHERE column3 > '20220201' AND column4 = 2134572 UNION ALL SELECT * FROM database0::table1 WHERE column3 > '20220201' AND column4 = 2134572 ) a ) SELECT avg(column0) FROM combined_data WHERE id = 1;
WITH merchant_data AS ( SELECT DISTINCT column0, column1 FROM table0 WHERE column1 != 0 AND column0 != 0 AND column2 = 0 AND column3 <= '2023-01-01 00:00:00' ), trade_data AS ( SELECT column4, column5 FROM table1 WHERE column5 != 0 AND column4 = 20230101 AND column6 IN (10) ) SELECT COUNT(DISTINCT t1.column0) AS count_zhusao FROM merchant_data t1 LEFT JOIN trade_data t2 ON t1.column1 = t2.column5;
WITH aggregated_transfers AS ( SELECT column0, SUM(column4) / 100 AS column2, COUNT(column5) AS column3 FROM table0 WHERE column6 >= date0 AND column6 <= date1 AND column7 = value0 GROUP BY column0 ), merchant_info AS ( SELECT column8, column1 FROM table1 ) SELECT t1.column0, t2.column1, t1.column2, t1.column3 FROM aggregated_transfers t1 LEFT JOIN merchant_info t2 ON t1.column0 = t2.column8 ORDER BY t1.column2 DESC;
SELECT column0, count(1) FROM ( SELECT column1, column0, column2, column3, column4, column5, ROW_NUMBER() OVER (PARTITION BY column1 ORDER BY column6 DESC) AS r FROM table0 WHERE column7 >= 2023010101 AND column7 <= 2023010103 AND column2 = 12345 ) subquery WHERE r = 1 GROUP BY column0 ORDER BY column0
WITH t1 AS ( SELECT column0 FROM table0 WHERE column1 = value0 ) SELECT t2.column3 FROM t1 LEFT JOIN table1 t2 ON t1.column0 = t2.column3 AND t2.ds > value1 AND t2.column6 = value2 AND t2.column4 = value3 WHERE t2.column3 IS NULL
WITH t1 AS ( SELECT `column0` FROM table0 WHERE column1 = 'value0' ), t2 AS ( SELECT column2, column3, column4, column5, column6 FROM table1 WHERE column7 > 'value1' AND column6 = 3 AND column4 = 'value2' ) SELECT t1.column0 FROM t1 WHERE NOT EXISTS ( SELECT 1 FROM t2 WHERE t1.column0 = t2.column3 );
WITH unique_records AS ( SELECT DISTINCT column1, column2, column3, column4, column5, column0 FROM table0 WHERE column5 = string0 AND column4 = string1 AND column2 = string2 AND column3 = string3 ) SELECT SUM(column0) AS sum_column0 FROM unique_records;
